<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoPixel LED Controller</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--gray);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger);
        }

        .status-indicator.connected {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        h2 {
            font-size: 1.5rem;
        }

        .toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .toggle-label {
            font-size: 1.1rem;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray);
            transition: var(--transition);
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .effect-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .effect-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--light);
            padding: 12px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 0.9rem;
        }

        .effect-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .effect-btn.active {
            background: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .slider-value {
            font-weight: bold;
            color: var(--success);
        }

        .range-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .color-input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            font-size: 1rem;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .effect-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .effect-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-lightbulb"></i> NeoPixel LED Controller</h1>
            <p class="subtitle">Control your LED strip remotely via Firebase</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="connectionStatus"></div>
                <span id="statusText">Connecting to Firebase...</span>
            </div>
            <div class="status-item">
                <i class="fas fa-microchip"></i>
                <span>ESP32 NeoPixel Controller</span>
            </div>
        </div>

        <div class="card-grid">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-power-off"></i>
                    <h2>Power Control</h2>
                </div>
                <div class="toggle-container">
                    <span class="toggle-label">LED Strip Power</span>
                    <label class="toggle">
                        <input type="checkbox" id="powerToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="toggle-container">
                    <span class="toggle-label">Auto Darkness Control</span>
                    <label class="toggle">
                        <input type="checkbox" id="autoDarknessToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                    <i class="fas fa-info-circle"></i> Auto darkness control turns off LEDs when ambient light is below threshold.
                </p>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-palette"></i>
                    <h2>Effects</h2>
                </div>
                <p>Select from 21 unique animation effects:</p>
                <div class="effect-grid" id="effectGrid">
                    <!-- Effects will be populated by JavaScript -->
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-tachometer-alt"></i>
                    <h2>Speed & Color</h2>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Animation Speed</span>
                        <span class="slider-value" id="speedValue">50</span>
                    </div>
                    <input type="range" min="10" max="200" value="50" class="range-slider" id="speedSlider">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 5px;">
                        <span>Slow</span>
                        <span>Fast</span>
                    </div>
                </div>

                <div class="color-picker-container">
                    <div class="color-preview" id="colorPreview" style="background-color: #FF0000;"></div>
                    <input type="text" class="color-input" id="colorInput" value="FF0000" placeholder="Hex color (e.g., FF0000)">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="applyColorBtn">
                        <i class="fas fa-check"></i> Apply Color
                    </button>
                    <button class="btn btn-secondary" id="randomColorBtn">
                        <i class="fas fa-random"></i> Random
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>NeoPixel LED Controller &copy; 2023 | Connected to Firebase Realtime Database</p>
        </footer>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC-8dRf8a9y7v9y8z7x6w5v4u3y2i1o0p9",
            authDomain: "test-dbd7a-default-rtdb.firebaseapp.com",
            databaseURL: "https://test-dbd7a-default-rtdb.firebaseio.com",
            projectId: "test-dbd7a",
            storageBucket: "test-dbd7a.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements
        const connectionStatus = document.getElementById('connectionStatus');
        const statusText = document.getElementById('statusText');
        const powerToggle = document.getElementById('powerToggle');
        const autoDarknessToggle = document.getElementById('autoDarknessToggle');
        const effectGrid = document.getElementById('effectGrid');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const colorInput = document.getElementById('colorInput');
        const colorPreview = document.getElementById('colorPreview');
        const applyColorBtn = document.getElementById('applyColorBtn');
        const randomColorBtn = document.getElementById('randomColorBtn');

        // Effect names matching the ESP32 code
        const effects = [
            "Rainbow Cycle", "Meteor Shower", "Digital Rain", "Pulsing Spheres", "Binary Clock",
            "Vortex", "DNA Helix", "Audio Visualizer", "Lava Lamp", "Radar Sweep",
            "Quantum Particles", "Neural Network", "Galaxy Spin", "Crystal Growth", "Lightning Storm",
            "Ocean Depth", "Northern Lights", "Time Tunnel", "Cyber City", "Solar Flare", "Fire Simulation"
        ];

        // Current state
        let currentState = {
            effect: 0,
            speed: 50,
            color: "FF0000",
            enabled: false,
            auto_darkness_control: false
        };

        // Initialize the effect grid
        function initializeEffectGrid() {
            effectGrid.innerHTML = '';
            effects.forEach((effect, index) => {
                const button = document.createElement('button');
                button.className = 'effect-btn';
                button.textContent = effect;
                button.dataset.effectId = index;
                
                if (index === currentState.effect) {
                    button.classList.add('active');
                }
                
                button.addEventListener('click', () => {
                    document.querySelectorAll('.effect-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    updateFirebaseValue('effect', parseInt(button.dataset.effectId));
                });
                
                effectGrid.appendChild(button);
            });
        }

        // Update Firebase value
        function updateFirebaseValue(path, value) {
            database.ref(path).set(value)
                .then(() => {
                    console.log(`Updated ${path} to ${value}`);
                })
                .catch((error) => {
                    console.error(`Error updating ${path}:`, error);
                });
        }

        // Generate random hex color
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Validate hex color
        function isValidHexColor(color) {
            return /^[0-9A-F]{6}$/i.test(color);
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Power toggle
            powerToggle.addEventListener('change', () => {
                updateFirebaseValue('enabled', powerToggle.checked);
            });

            // Auto darkness toggle
            autoDarknessToggle.addEventListener('change', () => {
                updateFirebaseValue('auto_darkness_control', autoDarknessToggle.checked);
            });

            // Speed slider
            speedSlider.addEventListener('input', () => {
                speedValue.textContent = speedSlider.value;
            });

            speedSlider.addEventListener('change', () => {
                updateFirebaseValue('speed', parseInt(speedSlider.value));
            });

            // Color input
            colorInput.addEventListener('input', () => {
                const color = colorInput.value.toUpperCase();
                if (isValidHexColor(color)) {
                    colorPreview.style.backgroundColor = `#${color}`;
                }
            });

            // Apply color button
            applyColorBtn.addEventListener('click', () => {
                const color = colorInput.value.toUpperCase();
                if (isValidHexColor(color)) {
                    updateFirebaseValue('color', color);
                } else {
                    alert('Please enter a valid 6-digit hex color code (e.g., FF0000)');
                    colorInput.focus();
                }
            });

            // Random color button
            randomColorBtn.addEventListener('click', () => {
                const randomColor = getRandomColor();
                colorInput.value = randomColor;
                colorPreview.style.backgroundColor = `#${randomColor}`;
                updateFirebaseValue('color', randomColor);
            });
        }

        // Listen for Firebase value changes
        function initializeFirebaseListeners() {
            // Effect
            database.ref('effect').on('value', (snapshot) => {
                const effect = snapshot.val();
                if (effect !== null) {
                    currentState.effect = effect;
                    document.querySelectorAll('.effect-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (parseInt(btn.dataset.effectId) === effect) {
                            btn.classList.add('active');
                        }
                    });
                }
            });

            // Speed
            database.ref('speed').on('value', (snapshot) => {
                const speed = snapshot.val();
                if (speed !== null) {
                    currentState.speed = speed;
                    speedSlider.value = speed;
                    speedValue.textContent = speed;
                }
            });

            // Color
            database.ref('color').on('value', (snapshot) => {
                const color = snapshot.val();
                if (color !== null) {
                    currentState.color = color;
                    colorInput.value = color;
                    colorPreview.style.backgroundColor = `#${color}`;
                }
            });

            // Enabled
            database.ref('enabled').on('value', (snapshot) => {
                const enabled = snapshot.val();
                if (enabled !== null) {
                    currentState.enabled = enabled;
                    powerToggle.checked = enabled;
                }
            });

            // Auto darkness control
            database.ref('auto_darkness_control').on('value', (snapshot) => {
                const autoDarkness = snapshot.val();
                if (autoDarkness !== null) {
                    currentState.auto_darkness_control = autoDarkness;
                    autoDarknessToggle.checked = autoDarkness;
                }
            });

            // Connection status
            database.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    connectionStatus.className = 'status-indicator connected';
                    statusText.textContent = 'Connected to Firebase';
                } else {
                    connectionStatus.className = 'status-indicator';
                    statusText.textContent = 'Disconnected from Firebase';
                }
            });
        }

        // Initialize the application
        function initializeApp() {
            initializeEffectGrid();
            initializeEventListeners();
            initializeFirebaseListeners();
            
            // Set initial color preview
            colorPreview.style.backgroundColor = `#${currentState.color}`;
        }

        // Start the application when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>